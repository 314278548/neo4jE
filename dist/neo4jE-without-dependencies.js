!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t(require("@babel/runtime-corejs3/regenerator"),require("@babel/runtime-corejs3/helpers/defineProperty"),require("neo4j-driver"),require("@babel/runtime-corejs3/core-js-stable/object/values"),require("@babel/runtime-corejs3/core-js-stable/instance/for-each"),require("@babel/runtime-corejs3/core-js-stable/instance/map"),require("@babel/runtime-corejs3/core-js/get-iterator"),require("@babel/runtime-corejs3/core-js-stable/promise"),require("@babel/runtime-corejs3/core-js-stable/instance/concat"),require("@babel/runtime-corejs3/core-js-stable/instance/includes"),require("@babel/runtime-corejs3/core-js-stable/instance/find-index"),require("@babel/runtime-corejs3/helpers/typeof"),require("@babel/runtime-corejs3/helpers/classCallCheck"),require("@babel/runtime-corejs3/helpers/createClass")):"function"==typeof define&&define.amd?define(["@babel/runtime-corejs3/regenerator","@babel/runtime-corejs3/helpers/defineProperty","neo4j-driver","@babel/runtime-corejs3/core-js-stable/object/values","@babel/runtime-corejs3/core-js-stable/instance/for-each","@babel/runtime-corejs3/core-js-stable/instance/map","@babel/runtime-corejs3/core-js/get-iterator","@babel/runtime-corejs3/core-js-stable/promise","@babel/runtime-corejs3/core-js-stable/instance/concat","@babel/runtime-corejs3/core-js-stable/instance/includes","@babel/runtime-corejs3/core-js-stable/instance/find-index","@babel/runtime-corejs3/helpers/typeof","@babel/runtime-corejs3/helpers/classCallCheck","@babel/runtime-corejs3/helpers/createClass"],t):"object"==typeof exports?exports.Neo4jE=t(require("@babel/runtime-corejs3/regenerator"),require("@babel/runtime-corejs3/helpers/defineProperty"),require("neo4j-driver"),require("@babel/runtime-corejs3/core-js-stable/object/values"),require("@babel/runtime-corejs3/core-js-stable/instance/for-each"),require("@babel/runtime-corejs3/core-js-stable/instance/map"),require("@babel/runtime-corejs3/core-js/get-iterator"),require("@babel/runtime-corejs3/core-js-stable/promise"),require("@babel/runtime-corejs3/core-js-stable/instance/concat"),require("@babel/runtime-corejs3/core-js-stable/instance/includes"),require("@babel/runtime-corejs3/core-js-stable/instance/find-index"),require("@babel/runtime-corejs3/helpers/typeof"),require("@babel/runtime-corejs3/helpers/classCallCheck"),require("@babel/runtime-corejs3/helpers/createClass")):e.Neo4jE=t(e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0],e[void 0])}(window,(function(e,t,r,n,o,s,i,a,c,u,l,d,b,p){return function(e){var t={};function r(n){if(t[n])return t[n].exports;var o=t[n]={i:n,l:!1,exports:{}};return e[n].call(o.exports,o,o.exports,r),o.l=!0,o.exports}return r.m=e,r.c=t,r.d=function(e,t,n){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(r.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var o in e)r.d(n,o,function(t){return e[t]}.bind(null,o));return n},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=14)}([function(t,r){t.exports=e},function(e,r){e.exports=t},function(e,t){e.exports=r},function(e,t){e.exports=n},function(e,t){e.exports=o},function(e,t){e.exports=s},function(e,t){e.exports=i},function(e,t){e.exports=a},function(e,t){e.exports=c},function(e,t){e.exports=u},function(e,t){e.exports=l},function(e,t){e.exports=d},function(e,t){e.exports=b},function(e,t){e.exports=p},function(e,t,r){"use strict";r.r(t),r.d(t,"default",(function(){return S}));var n=r(9),o=r.n(n),s=r(10),i=r.n(s),a=r(7),c=r.n(a),u=r(5),l=r.n(u),d=r(0),b=r.n(d),p=r(8),f=r.n(p),h=r(11),g=r.n(h),_=r(6),v=r.n(_),j=r(3),m=r.n(j),y=r(4),x=r.n(y),w=r(12),k=r.n(w),L=r(13),q=r.n(L),O=r(1),N=r.n(O),C=r(2),E=r.n(C),S=function(){function e(t){var r=this;k()(this,e),N()(this,"_nodes",{}),N()(this,"_edges",{}),N()(this,"_groups",{}),N()(this,"instance",{}),N()(this,"hide_nodes",{}),N()(this,"show_nodes",{}),N()(this,"defaults",{neo4jUri:"bolt://localhost:7687",neo4jUser:"neo4j",neo4jPassword:"neo4j",encrypted:"ENCRYPTION_OFF",trust:"TRUST_ALL_CERTIFICATES",initialQuery:"MATCH (n)-[r]->(m) RETURN * limit 200",domId:"echarts"}),N()(this,"dispose",(function(){r.instance.dispose()})),N()(this,"_fold",(function(e){if(!r.hide_nodes[e]){r.hide_nodes[e]=r._nodes[e],delete r.show_nodes[e];var t,n=r._nodes[e];if(n.sub_node_ids)x()(t=m()(n.sub_node_ids)).call(t,(function(e){return r._fold(e)}))}})),N()(this,"_option",{animation:!0,title:{text:"Les Miserables",subtext:"Default layout",top:"bottom",left:"right"},tooltip:{trigger:"item"},legend:[],series:[{focusNodeAdjacency:!0,edgeSymbol:["circle","arrow"],symbolSize:55,name:"Les Miserables",type:"graph",layout:"force",data:[],edges:[],categories:[],roam:!0,itemStyle:{normal:{borderColor:"#fff",borderWidth:1,shadowBlur:10,shadowColor:"rgba(0, 0, 0, 0.3)"}},force:{initLayout:"circular",layoutAnimation:!0,repulsion:1e3,gravity:0,edgeLength:[30,1e4]},circular:{rotateLabel:!0},draggable:!0,label:{show:!0,position:"inside",textStyle:{fontWeight:"bold",fontSize:12}},edgeLabel:{show:!0,position:"middle",formatter:function(e){return e.data.label}},lineStyle:{color:"source",curveness:.3},tooltip:{formatter:function(e){return e.data.title}}}]}),this._init(t)}return q()(e,[{key:"_init",value:function(e){var t=this.defaults;this._config=e,this._encrypted=e.encrypted||t.encrypted,this._trust=e.trust||t.trust,this._driver=E.a.driver(e.server_url||t.neo4jUri,E.a.auth.basic(e.server_user||t.neo4jUser,e.server_password||t.neo4jPassword),{encrypted:this._encrypted,trust:this._trust}),this._initEcharts()}},{key:"_initEcharts",value:function(){var e=this;this._consoleLog(this._config.id||this.defaults.domId);var t=this.instance=this._config.instance;t.setOption(this._config.option||this._option),t.on("click",(function(r){if("node"===r.dataType){e._consoleLog(r);var n=r.data.sub_node_ids;if(n){var o;e.showL();var s=e.instance.getOption(),i=[],a=0;if(e._consoleLog(e.hide_nodes),x()(o=m()(n)).call(o,(function(t){var r=e.hide_nodes[t];r&&(a++,i.push(r))})),a>0){e._consoleLog("需要展开的节点"),e._consoleLog(i);var c=s.series[0].data;x()(i).call(i,(function(t){e._consoleLog("expand ".concat(t.name));var r=t.id;e.show_nodes[r]=t,c.push(t),delete e.hide_nodes[r]}))}else{var u;e._consoleLog("需要隐藏的节点"),e._consoleLog(n),x()(u=m()(n)).call(u,(function(t){e._fold(t)})),s.series[0].data=m()(e.show_nodes)}t.setOption(s),e.hideL()}}}))}},{key:"_clear",value:function(){this._consoleLog("开始清理"),this.hide_nodes={},this.show_nodes={},this._nodes={},this._edges={},this._groups={},this._consoleLog("清理完毕")}},{key:"_addNode",value:function(e){this._nodes[e.id]=e,e.group&&(this._groups[e.group]={name:e.group})}},{key:"_addEdge",value:function(e){this._edges[e.id]=e}},{key:"buildNodeVisObject",value:function(e){var t,r,n,o,s,i,a,c,u,l,d,p,h,_,j,m,y,w;return b.a.async((function(k){for(;;)switch(k.prev=k.next){case 0:if(t={},r=e.labels[0],n=this._config&&this._config.labels&&this._config.labels[r],o=n&&n.caption,s=n&&n.size,i=n&&n.sizeCypher,a=n&&n.community,t.id=e.identity.toInt(),!i){k.next=34;break}return c=this._driver.session(),k.next=12,b.a.awrap(c.run(i,{id:E.a.int(t.id)}));case 12:for(u=k.sent,l=!0,d=!1,p=void 0,k.prev=16,h=v()(u.records);!(l=(_=h.next()).done);l=!0)j=_.value,x()(j).call(j,(function(e){"number"==typeof e?t.value=e:E.a.isInt(e)&&(t.value=e.toNumber())}));k.next=24;break;case 20:k.prev=20,k.t0=k.catch(16),d=!0,p=k.t0;case 24:k.prev=24,k.prev=25,l||null==h.return||h.return();case 27:if(k.prev=27,!d){k.next=30;break}throw p;case 30:return k.finish(27);case 31:return k.finish(24);case 32:k.next=35;break;case 34:"number"==typeof s?t.value=s:(m=e.properties[s])&&"number"==typeof m?t.value=m:m&&"object"===g()(m)&&E.a.isInt(m)&&m.inSafeRange()?t.value=m.toNumber():t.value=1;case 35:if(t.label="function"==typeof o?o(e):e.properties[o]||r||"",a)try{e.properties[a]?t.group=e.properties[a].toNumber()||r||0:t.group=0}catch(e){t.group=0}else t.group=r;for(y in t.title="",e.properties)e.properties.hasOwnProperty(y)&&(t.title+=f()(w="<strong>".concat(y,":</strong> ")).call(w,e.properties[y],"<br>"));return k.abrupt("return",t);case 40:case"end":return k.stop()}}),null,this,[[16,20,24,32],[25,,27,31]])}},{key:"buildEdgeVisObject",value:function(e){var t=this._config&&this._config.relationships&&this._config.relationships[e.type],r=t&&t.thickness,n=t&&t.caption,o={};for(var s in o.id=e.identity.toInt(),o.from=e.start.toInt(),o.to=e.end.toInt(),o.source=e.start.toString(),o.target=e.end.toString(),o.title="",e.properties){var i;if(e.properties.hasOwnProperty(s))o.title+=f()(i="<strong>".concat(s,":</strong> ")).call(i,e.properties[s],"<br>")}return o.value=r&&"string"==typeof r?e.properties[r]:r&&"number"==typeof r?r:1,o.label="boolean"==typeof n?n?e.type:"":n&&"string"==typeof n?e.properties[n]||"":e.type,o}},{key:"_consoleLog",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"log";("log"!==t||this._config.console_debug)&&console[t](e)}},{key:"hideL",value:function(){this.instance.hideLoading()}},{key:"showL",value:function(){this.instance.showLoading({text:"数据获取中",effect:"whirling"})}},{key:"query",value:function(e){var t=this,r=this._driver.session(),n=[];r.run(e,{limit:30}).subscribe({onNext:function(e){var r;0;var o=l()(r=m()(e.toObject())).call(r,(function(e){var r,n,o,s,i,a,c,u,l,d,p,f,h,g,_,j,m,y;return b.a.async((function(x){for(;;)switch(x.prev=x.next){case 0:if(!(e instanceof E.a.types.Node)){x.next=7;break}return x.next=3,b.a.awrap(t.buildNodeVisObject(e));case 3:r=x.sent;try{t._addNode(r)}catch(e){t._consoleLog(e,"error")}x.next=91;break;case 7:if(!(e instanceof E.a.types.Relationship)){x.next=12;break}n=t.buildEdgeVisObject(e),t._addEdge(n),x.next=91;break;case 12:if(!(e instanceof E.a.types.Path)){x.next=58;break}return x.next=15,b.a.awrap(t.buildNodeVisObject(e.start));case 15:return o=x.sent,x.next=18,b.a.awrap(t.buildNodeVisObject(e.end));case 18:s=x.sent,t._addNode(o),t._addNode(s),i=!0,a=!1,c=void 0,x.prev=24,u=v()(e.segments);case 26:if(i=(l=u.next()).done){x.next=42;break}return d=l.value,x.t0=t,x.next=31,b.a.awrap(t.buildNodeVisObject(d.start));case 31:return x.t1=x.sent,x.t0._addNode.call(x.t0,x.t1),x.t2=t,x.next=36,b.a.awrap(t.buildNodeVisObject(d.end));case 36:x.t3=x.sent,x.t2._addNode.call(x.t2,x.t3),t._addEdge(t.buildEdgeVisObject(d.relationship));case 39:i=!0,x.next=26;break;case 42:x.next=48;break;case 44:x.prev=44,x.t4=x.catch(24),a=!0,c=x.t4;case 48:x.prev=48,x.prev=49,i||null==u.return||u.return();case 51:if(x.prev=51,!a){x.next=54;break}throw c;case 54:return x.finish(51);case 55:return x.finish(48);case 56:x.next=91;break;case 58:if(!(e instanceof Array)){x.next=91;break}p=!0,f=!1,h=void 0,x.prev=62,g=v()(e);case 64:if(p=(_=g.next()).done){x.next=77;break}if(!((j=_.value)instanceof E.a.types.Node)){x.next=73;break}return x.next=69,b.a.awrap(t.buildNodeVisObject(j));case 69:m=x.sent,t._addNode(m),x.next=74;break;case 73:j instanceof E.a.types.Relationship&&(y=t.buildEdgeVisObject(j),t._addEdge(y));case 74:p=!0,x.next=64;break;case 77:x.next=83;break;case 79:x.prev=79,x.t5=x.catch(62),f=!0,h=x.t5;case 83:x.prev=83,x.prev=84,p||null==g.return||g.return();case 86:if(x.prev=86,!f){x.next=89;break}throw h;case 89:return x.finish(86);case 90:return x.finish(83);case 91:case"end":return x.stop()}}),null,null,[[24,44,48,56],[49,,51,55],[62,79,83,91],[84,,86,90]])}));n.push(c.a.all(o))},onCompleted:function(){var e,s,a,u,d,p,f,h,g,_,v,j,y,x,w,k,L;return b.a.async((function(q){for(;;)switch(q.prev=q.next){case 0:return q.next=2,b.a.awrap(c.a.all(n));case 2:for(p in r.close(),t._consoleLog("开始处理数据"),s=t.show_nodes,a=t.hide_nodes,u=t._nodes,d=t._edges)f=d[p],h=u[f.source],g=u[f.target],(_=h.sub_node_ids)||(_=h.sub_node_ids={}),_[g.id]=g.id;for(x in v=l()(e=m()(d)).call(e,(function(e){return{target:e.target,source:e.source,label:e.label}})),j=m()(t._groups),y=l()(v).call(v,(function(e){return e.target})),u)(w=u[x]).name=w.label,w.value=w.id,w.group&&(w.category=i()(j).call(j,(function(e){return e.name===w.group}))),o()(y).call(y,w.id.toString())?a[w.id]=w:s[w.id]=w;t._consoleLog(s),t._consoleLog(t.show_nodes),(k=t.instance.getOption()).legend=[{data:l()(j).call(j,(function(e){return e.name}))}],L=m()(s),k.series[0].data=L,k.series[0].edges=v,k.series[0].categories=j,t._consoleLog("数据梳理完成"),t._consoleLog(k),t.instance.setOption(k),t.hideL();case 25:case"end":return q.stop()}}))},onError:function(e){t._consoleLog(e,"error")}})}},{key:"render",value:function(e){this._consoleLog("开始查询"),this._clear(),this.showL(),this.query(e)}}]),e}()}])}));
//# sourceMappingURL=neo4jE-without-dependencies.js.map